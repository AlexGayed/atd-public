{% extends "bootstrap/base.html" %}

{% block title %} Arista ATD Lab Selection {% endblock %}

{% block navbar %}
<div class="alert alert-info"><h1>Arista ATD Lab Selection</h1></div>
{% endblock %}

{% block content %}
<h2 style="text-indent: 1em">Choose a lab: </h2>
{% for menu_type in vars %}
<div style="text-indent: 2em">
    <table>
        <tr><h4> {{ menu_type }} </h4></tr>
        <td><select id="{{menu_type}}LabSelection" name="{{menu_type}}LabSelection">
            {% for menu_item in vars[menu_type] %}
            <option value={{menu_item}}> {{ menu_item }} </option>
            {% endfor %}
        </select></td>
        <td><button onclick="execute{{menu_type}}Lab()" id="{{menu_type}}SubmitButton">Execute {{ menu_type }} Lab</button></td>
        {% endfor %}
    </table>
</div>
<h3 style="text-indent: 1em">Last Executed Lab: </h3>
<h4 id="lastExecuted" style="text-indent: 1em"></h4>
<h3 style="text-indent: 1em">Execution Status: </h3>
<h4 id="executionStatus" style="text-indent: 1em"></h4>
{% endblock %}

{% block scripts %}
<script>
    {% for menu_type in vars %}
    function execute{{menu_type}}Lab() {
        var lab = document.getElementById("{{menu_type}}LabSelection")
        var selectedLab = lab.options[lab.selectedIndex].text;
        document.getElementById("lastExecuted").innerText = "{{menu_type}}".concat(': ', selectedLab);
        var request = new XMLHttpRequest()
        
        var requestData = {};
        requestData.selectedMenu = "{{ menu_type }}";
        requestData.selectedLab = selectedLab;
        request.open('POST', "http://localhost:5000/runscript");
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200) {
                document.getElementById("executionStatus").innerText = request.responseText;
            }
        }
        request.send(JSON.stringify(requestData));
        console.log(request);
        
    }
    {% endfor %}
</script>
{% endblock %}