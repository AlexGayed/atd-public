{% extends "bootstrap/base.html" %}

{% block title %} Arista ATD Lab Selection {% endblock %}

{% block navbar %}
<div class="alert alert-info"><h1>Arista ATD Lab Selection</h1></div>
{% endblock %}

{% block content %}
<h2 style="text-indent: 1em">Choose a lab: </h2>
{% for menu_type in vars %}
<div style="text-indent: 2em">
    <table>
        <tr><h4> {{ menu_type }} </h4></tr>
        <td><select id="{{menu_type}}LabSelection" name="{{menu_type}}LabSelection">
            {% for menu_item in vars[menu_type] %}
            <option value={{menu_item}}> {{ menu_item }} </option>
            {% endfor %}
        </select></td>
        <td><button onclick="execute{{menu_type}}Lab()" id="{{menu_type}}SubmitButton">Execute {{ menu_type }} Lab</button></td>
        {% endfor %}
    </table>
</div>
<h3 style="text-indent: 1em">Last Executed Lab: </h3>
<h4 id="lastExecuted" style="text-indent: 1em"></h4>
<h3 style="text-indent: 1em">Execution Status: </h3>
<h4 id="executionStatus" style="text-indent: 1em"></h4>
{% endblock %}

{% block scripts %}
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8">
    
    // loop through menus to create button click functions
    {% for menu_type in vars %}
    function execute{{menu_type}}Lab() {

        var socket = io.connect('http://127.0.0.1:5000');
        var lab = document.getElementById("{{menu_type}}LabSelection")
        var selectedLab = lab.options[lab.selectedIndex].text;
        var requestData = {};
        requestData.selectedMenu = "{{ menu_type }}";
        requestData.selectedLab = selectedLab;

        $('#{{menu_type}}SubmitButton').click(function() {

            socket.send(requestData);

        });
    }
    {% endfor %}

    // Set stage for incoming socket events
    $(document).ready(function() {
        var socket = io.connect('http://127.0.0.1:8888');
        socket.on('sendUpdate', function(event) {
            console.log(event);
            $('#executionStatus').text(event);
        });
    });
    
</script>
{% endblock %}